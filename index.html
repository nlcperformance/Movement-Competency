<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Movement Competency Dashboard</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter font from Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
    </style>
    <!-- React and ReactDOM CDNs -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel CDN for JSX transformation in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="min-h-screen bg-gray-100 text-gray-900 flex flex-col items-center p-4 sm:p-6 lg:p-8">

    <div id="root" class="w-full max-w-6xl bg-white shadow-lg rounded-xl overflow-hidden border border-gray-200">
        <!-- React app will be mounted here -->
    </div>

    <script type="text/babel">
        // Main App component
        const App = () => {
          // Define initial client data and movements
          const [clientName, setClientName] = React.useState("John Doe");
          const [assessmentDate, setAssessmentDate] = React.useState("2025-08-12");
          const [nextAssessmentDate, setNextAssessmentDate] = React.useState("2025-09-12");

          // R.A.G.E. System movements data
          const [movements, setMovements] = React.useState([
            {
              category: "Knee Health & Control",
              movement: "Poliquin Step-ups",
              currentStatus: "Amber",
              lastAssessment: "Red",
              notes: "",
            },
            {
              category: "Knee Health & Control",
              movement: "ATG VMO Squats",
              currentStatus: "Green",
              lastAssessment: "Amber",
              notes: "",
            },
            {
              category: "Upper Body Strength",
              movement: "Pull-ups (Bodyweight)",
              currentStatus: "Green",
              lastAssessment: "Green",
              notes: "",
            },
            {
              category: "Upper Body Strength",
              movement: "Pull-ups (Weighted)",
              currentStatus: "Elite",
              lastAssessment: "Green",
              notes: "",
            },
            {
              category: "Core & Spine Stability",
              movement: "McGill Big 3 (Hold Times)",
              currentStatus: "Amber",
              lastAssessment: "Amber",
              notes: "",
            },
            {
              category: "Postural Integrity",
              movement: "Neck Isometrics/Harness Holds",
              currentStatus: "Red",
              lastAssessment: "N/A",
              notes: "",
            },
            {
              category: "Scapular Control",
              movement: "Dead Hangs / Scap Control",
              currentStatus: "Green",
              lastAssessment: "Amber",
              notes: "",
            },
            {
              category: "Athleticism & Coordination",
              movement: "Rope Flow / Jump Mechanics",
              currentStatus: "Amber",
              lastAssessment: "N/A",
              notes: "",
            },
          ]);

          // State for the focus areas
          const [primaryFocus, setPrimaryFocus] = React.useState("");
          const [secondaryFocus, setSecondaryFocus] = React.useState("");

          // Define R.A.G.E. levels and their numerical values for trend calculation
          const rageLevels = ["N/A", "Red", "Amber", "Green", "Elite"];
          const rageValues = { "N/A": 0, "Red": 1, "Amber": 2, "Green": 3, "Elite": 4 };

          // Function to get Tailwind CSS class for R.A.G.E. status
          const getStatusColorClass = (status) => {
            switch (status) {
              case "Red":
                return "bg-red-500";
              case "Amber":
                return "bg-yellow-500";
              case "Green":
                return "bg-green-500";
              case "Elite":
                return "bg-black text-white";
              default:
                return "bg-gray-400"; // For N/A or undefined
            }
          };

          // Function to calculate the trend
          const calculateTrend = (lastStatus, currentStatus) => {
            if (lastStatus === "N/A") {
              // If there's no previous assessment, there's no trend to compare
              return "N/A";
            }

            const lastValue = rageValues[lastStatus];
            const currentValue = rageValues[currentStatus];

            if (currentValue > lastValue) {
              return "up";
            } else if (currentValue < lastValue) {
              return "down";
            } else {
              return "steady";
            }
          };

          // Function to get trend icon based on calculated trend
          const getTrendIcon = (trend) => {
            switch (trend) {
              case "up":
                return "⬆️";
              case "down":
                return "⬇️";
              case "steady":
                return "➡️";
              default:
                return "";
            }
          };

          // Handle changes to movement status (Current Status or Last Assessment)
          const handleStatusChange = (index, field, value) => {
            const newMovements = [...movements];
            newMovements[index][field] = value;
            setMovements(newMovements);
          };

          // Handle changes to notes
          const handleNotesChange = (index, value) => {
            const newMovements = [...movements];
            newMovements[index].notes = value;
            setMovements(newMovements);
          };

          // Calculate overall score (simple average of R.A.G.E. values)
          const calculateOverallScore = () => {
            if (movements.length === 0) return "N/A";
            let totalScore = 0;
            let validMovements = 0;
            movements.forEach((m) => {
              const value = rageValues[m.currentStatus];
              if (value !== undefined) {
                totalScore += value;
                validMovements++;
              }
            });

            if (validMovements === 0) return "N/A";
            const avg = totalScore / validMovements;
            if (avg >= 3.5) return "Excellent";
            if (avg >= 2.5) return "Good";
            if (avg >= 1.5) return "Fair";
            return "Needs Focus";
          };

          const overallScore = calculateOverallScore();

          // Function to download data as CSV
          const downloadCSV = () => {
            const headers = [
              "Category",
              "Movement",
              "Current Status",
              "Last Assessment",
              "Trend",
              "Notes",
            ];
            const rows = movements.map((m) => [
              m.category,
              m.movement,
              m.currentStatus,
              m.lastAssessment,
              getTrendIcon(calculateTrend(m.lastAssessment, m.currentStatus)), // Calculate trend for CSV
              m.notes,
            ]);

            let csvContent = headers.map((h) => `"${h}"`).join(",") + "\n";
            rows.forEach((row) => {
              csvContent += row.map((item) => `"${item}"`).join(",") + "\n";
            });

            // Add focus areas to CSV (as separate lines for clarity)
            csvContent += "\n\"Primary Focus\",,,,,,\n";
            csvContent += `"${primaryFocus.replace(/"/g, '""')}"\n`; // Escape double quotes
            csvContent += "\"Secondary Focus\",,,,,,\n";
            csvContent += `"${secondaryFocus.replace(/"/g, '""')}"\n`; // Escape double quotes


            const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
            const link = document.createElement("a");
            if (link.download !== undefined) {
              const url = URL.createObjectURL(blob);
              link.setAttribute("href", url);
              link.setAttribute("download", "client_movement_checklist.csv");
              link.style.visibility = "hidden";
              document.body.appendChild(link);
              link.click();
              document.body.removeChild(link);
            }
          };

          return (
            <div className="min-h-screen bg-gray-100 font-sans text-gray-900 flex flex-col items-center p-4 sm:p-6 lg:p-8">
              {/* Main container for the dashboard */}
              <div className="w-full max-w-6xl bg-white shadow-lg rounded-xl overflow-hidden border border-gray-200">
                {/* Header Section */}
                <div className="bg-black text-white p-6 sm:p-8 rounded-t-xl">
                  <div className="mb-4">
                    <label htmlFor="clientName" className="block text-lg font-semibold mb-1">
                      Client Name:
                    </label>
                    <input
                      type="text"
                      id="clientName"
                      className="w-full p-2 rounded-md bg-gray-800 text-white border border-gray-700 focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                      value={clientName}
                      onChange={(e) => setClientName(e.target.value)}
                      placeholder="Enter client name"
                    />
                  </div>
                  <h1 className="text-3xl sm:text-4xl font-bold mb-2">
                    {clientName}'s Movement Competency Dashboard
                  </h1>
                  <div className="flex flex-wrap text-sm sm:text-base gap-x-4 gap-y-2">
                    <p className="flex items-center">
                      <span className="font-semibold mr-2">Date of Assessment:</span>{" "}
                      <input
                        type="date"
                        className="p-1 rounded-md bg-gray-800 text-white border border-gray-700 focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                        value={assessmentDate}
                        onChange={(e) => setAssessmentDate(e.target.value)}
                      />
                    </p>
                    <p className="flex items-center">
                      <span className="font-semibold mr-2">Next Assessment:</span>{" "}
                      <input
                        type="date"
                        className="p-1 rounded-md bg-gray-800 text-white border border-gray-700 focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                        value={nextAssessmentDate}
                        onChange={(e) => setNextAssessmentDate(e.target.value)}
                      />
                    </p>
                    <p className="flex items-center">
                      <span className="font-semibold mr-2">Overall Movement Score:</span>{" "}
                      <span
                        className={`font-bold ${
                          overallScore === "Excellent"
                            ? "text-green-400"
                            : overallScore === "Good"
                            ? "text-orange-400"
                            : "text-red-400"
                        }`}
                      >
                        {overallScore}
                      </span>
                    </p>
                  </div>
                </div>

                {/* R.A.G.E. Legend */}
                <div className="p-6 sm:p-8 border-b border-gray-200">
                  <h2 className="text-xl sm:text-2xl font-semibold mb-4">
                    🧠 R.A.G.E. Movement Competency System
                  </h2>
                  <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 text-sm">
                    {[
                      {
                        level: "🔴 Red",
                        meaning: "Restricted",
                        criteria: "Pain, poor mechanics, fails regressions",
                        use: "Needs mobility/skill prep before loading",
                      },
                      {
                        level: "🟡 Amber",
                        meaning: "Asymmetrical / In Progress",
                        criteria: "Partial ROM, mild imbalance, unstable",
                        use: "Needs targeted support and cueing",
                      },
                      {
                        level: "🟢 Green",
                        meaning: "Good / Functional",
                        criteria: "Solid form, no pain, balanced ROM",
                        use: "Ready for regular use in training",
                      },
                      {
                        level: "⚫ Elite",
                        meaning: "Explosive / Loaded Proficiency",
                        criteria: "Loaded with power, tempo, or complexity",
                        use: "Can be used in Q&D / combat integration",
                      },
                    ].map((item, index) => (
                      <div
                        key={index}
                        className="bg-gray-50 p-4 rounded-lg border border-gray-100 shadow-sm"
                      >
                        <h3 className="font-bold text-base mb-1">{item.level}</h3>
                        <p className="font-semibold text-orange-600 mb-1">
                          {item.meaning}
                        </p>
                        <p className="text-gray-700">{item.criteria}</p>
                        <p className="text-gray-600 italic text-xs mt-1">
                          Coaching Use: {item.use}
                        </p>
                      </div>
                    ))}
                  </div>
                </div>

                {/* Movement Assessment Table */}
                <div className="p-6 sm:p-8 border-b border-gray-200">
                  <h2 className="text-xl sm:text-2xl font-semibold mb-4">
                    Movement Assessment at a Glance (Traffic-Light System)
                  </h2>
                  <div className="overflow-x-auto rounded-lg border border-gray-200 shadow-sm">
                    <table className="min-w-full divide-y divide-gray-200">
                      <thead className="bg-gray-50">
                        <tr>
                          <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Movement Category
                          </th>
                          <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Movement
                          </th>
                          <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Current Status
                          </th>
                          <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Last Assessment
                          </th>
                          <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Trend
                          </th>
                          <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Notes
                          </th>
                        </tr>
                      </thead>
                      <tbody className="bg-white divide-y divide-gray-200">
                        {movements.map((item, index) => (
                          <tr key={index}>
                            <td className="px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                              {item.category}
                            </td>
                            <td className="px-4 py-4 whitespace-nowrap text-sm text-gray-700">
                              ✅ {item.movement}
                            </td>
                            <td className="px-4 py-4 whitespace-nowrap">
                              <select
                                value={item.currentStatus}
                                onChange={(e) => handleStatusChange(index, 'currentStatus', e.target.value)}
                                className={`p-1 rounded-md text-xs font-semibold border ${getStatusColorClass(item.currentStatus)} ${item.currentStatus === "Elite" ? "text-white border-black" : "text-black border-gray-300"}`}
                              >
                                {rageLevels.filter(level => level !== "N/A").map(level => ( // Exclude N/A from current status options
                                  <option key={level} value={level}>{level}</option>
                                ))}
                              </select>
                            </td>
                            <td className="px-4 py-4 whitespace-nowrap text-sm text-gray-700">
                              <select
                                value={item.lastAssessment}
                                onChange={(e) => handleStatusChange(index, 'lastAssessment', e.target.value)}
                                className={`p-1 rounded-md text-xs font-semibold border ${getStatusColorClass(item.lastAssessment)} ${item.lastAssessment === "Elite" ? "text-white border-black" : "text-black border-gray-300"}`}
                              >
                                 {rageLevels.map(level => (
                                  <option key={level} value={level}>{level}</option>
                                ))}
                              </select>
                            </td>
                            <td className="px-4 py-4 whitespace-nowrap text-sm text-gray-700">
                              {getTrendIcon(calculateTrend(item.lastAssessment, item.currentStatus))}
                            </td>
                            <td className="px-4 py-4 text-sm text-gray-700">
                              <textarea
                                className="w-full p-1 rounded-md border border-gray-300 focus:ring-1 focus:ring-orange-500"
                                value={item.notes}
                                onChange={(e) => handleNotesChange(index, e.target.value)}
                                placeholder="Add notes..."
                                rows="2"
                              ></textarea>
                            </td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                  <div className="flex justify-center mt-6">
                    <button
                      onClick={downloadCSV}
                      className="bg-orange-600 hover:bg-orange-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-opacity-75"
                    >
                      Export to Google Sheet (CSV)
                    </button>
                  </div>
                </div>

                {/* Focus for the Next Training Block */}
                <div className="p-6 sm:p-8">
                  <h2 className="text-xl sm:text-2xl font-semibold mb-4">
                    Focus for the Next Training Block
                  </h2>
                  <div className="bg-gray-50 p-6 rounded-lg border border-gray-100 shadow-sm text-gray-700">
                    <p className="mb-2">
                      <span className="font-semibold text-orange-600">
                        Primary Focus:
                      </span>
                    </p>
                    <textarea
                      className="w-full p-2 rounded-md border border-gray-300 focus:ring-1 focus:ring-orange-500 mb-4"
                      value={primaryFocus}
                      onChange={(e) => setPrimaryFocus(e.target.value)}
                      placeholder="Enter primary focus areas..."
                      rows="3"
                    ></textarea>
                    <p className="mb-2">
                      <span className="font-semibold text-orange-600">
                        Secondary Focus:
                      </span>
                    </p>
                    <textarea
                      className="w-full p-2 rounded-md border border-gray-300 focus:ring-1 focus:ring-orange-500"
                      value={secondaryFocus}
                      onChange={(e) => setSecondaryFocus(e.target.value)}
                      placeholder="Enter secondary focus areas..."
                      rows="3"
                    ></textarea>
                  </div>
                </div>
              </div>
            </div>
          );
        };

        // Render the App component to the 'root' div
        // React 18: Use createRoot instead of ReactDOM.render
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
